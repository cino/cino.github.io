<!doctype html><html class="h-full antialiased" style=--header-position:sticky;--content-offset:0px;--header-height:64px;--header-mb:0px;--header-top:0px;--avatar-top:0px lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>AWS Parameter Store vs AWS Secrets - Cino</title><link rel=canonical href=https://cino.io/2023/aws-parameter-store-vs-aws-secrets/><link rel=alternate type=application/rss+xml title=RSS href=https://cino.io/index.xml><link rel=apple-touch-icon sizes=57x57 href=/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=/android-icon-192x192.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><meta name=msapplication-TileColor content="#ffffff"><meta name=msapplication-TileImage content="/ms-icon-144x144.png"><meta name=theme-color content="#ffffff"><meta property="og:url" content="https://cino.io/2023/aws-parameter-store-vs-aws-secrets/"><meta property="og:site_name" content="Cino"><meta property="og:title" content="AWS Parameter Store vs AWS Secrets"><meta property="og:description" content="Recently I’ve been using AWS Secrets to retrieve API keys which are needed to access external API’s, however, this turned out to be a more expensive service than we initially thought when starting."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="2023"><meta property="article:published_time" content="2023-07-19T00:00:00+00:00"><meta property="article:modified_time" content="2023-07-19T00:00:00+00:00"><meta property="article:tag" content="Aws"><meta property="article:tag" content="Amazon Web Services"><meta property="article:tag" content="Tags/Parameter Store"><meta property="article:tag" content="Tags/Secrets"><meta property="article:tag" content="Serverless"><meta property="article:tag" content="Lambda"><meta name=twitter:card content="summary"><meta name=twitter:title content="AWS Parameter Store vs AWS Secrets"><meta name=twitter:description content="Recently I’ve been using AWS Secrets to retrieve API keys which are needed to access external API’s, however, this turned out to be a more expensive service than we initially thought when starting."><meta itemprop=name content="AWS Parameter Store vs AWS Secrets"><meta itemprop=description content="Recently I’ve been using AWS Secrets to retrieve API keys which are needed to access external API’s, however, this turned out to be a more expensive service than we initially thought when starting."><meta itemprop=datePublished content="2023-07-19T00:00:00+00:00"><meta itemprop=dateModified content="2023-07-19T00:00:00+00:00"><meta itemprop=wordCount content="1767"><meta itemprop=keywords content="Aws,Amazon Web Services,Tags/Parameter Store,Tags/Secrets,Serverless,Lambda,Tags/Cloudwatch Event,Tags/Rotation"><link rel=stylesheet href="https://cino.io/css/styles.min.a4b78abe810c6cc729f8d58e0ffbabeb9ed6a9643da610ae2d27df07439f016b.css" integrity="sha256-pLeKvoEMbMcp+NWOD/ur657WqWQ9phCuLSffB0OfAWs="><meta name=fediverse:creator content="@cino@fosstodon.org"><script async src="https://www.googletagmanager.com/gtag/js?id=G-GCGJ9S1XSX"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-GCGJ9S1XSX")}</script></head><body class="flex h-full flex-col bg-zinc-50"><div class="fixed inset-0 flex justify-center sm:px-8"><div class="flex w-full max-w-7xl lg:px-8"><div class="w-full bg-white ring-1 ring-zinc-100"></div></div></div><div class=relative><header class="pointer-events-none relative z-50 flex flex-col" style=height:var(--header-height);margin-bottom:var(--header-mb)><div class="top-0 z-10 h-16 pt-6" style=position:var(--header-position)><div class="sm:px-8 top-(--header-top,--spacing(6)) w-full" style=position:var(--header-inner-position)><div class="mx-auto max-w-7xl lg:px-8"><div class="relative px-4 sm:px-8 lg:px-12"><div class="mx-auto max-w-2xl lg:max-w-5xl"><div class="relative flex gap-4"><div class="flex flex-1"><div class="h-10 w-10 rounded-full bg-white/90 p-0.5 shadow-lg shadow-zinc-800/5 ring-1 ring-zinc-900/5 backdrop-blur-sm"><a aria-label=Home class=pointer-events-auto href=https://cino.io/><img alt sizes=2.25rem src=/img/ricardo-cino-36x36.png decoding=async data-nimg=1 class="rounded-full bg-zinc-100 object-cover h-9 w-9" style=color:transparent width=512 height=512 alt="Ricardo Cino"></a></div></div><div class="relative flex justify-end flex-1"><div class="mt-2 flex gap-6"><a class="group -m-1 p-1 pointer-events-auto" aria-label="Follow on Bluesky" href=https://bsky.app/profile/cino.io target=_blank><svg viewBox="0 0 24 24" width="24" height="24" class="h-6 w-6 fill-zinc-500 transition group-hover:fill-zinc-600 dark:fill-zinc-400 dark:group-hover:fill-zinc-300"><path style="stroke:none;fill-rule:nonzero" d="M4.550781 2.792969c2.410157 1.773437 5 5.371093 5.949219 7.296875V15.1875C10.5 15.078125 10.457031 15.203125 10.367188 15.464844 9.871094 16.894531 7.929688 22.476562 3.5 18.015625c-2.332031-2.351563-1.253906-4.699219 2.996094-5.40625-2.429688.40625-5.164063-.265625-5.914063-2.894531C.367188 8.960938.0 4.304688.0 3.675781.0.523438 2.816406 1.515625 4.550781 2.792969zm11.898438.0c-2.410157 1.773437-5 5.371093-5.949219 7.296875V15.1875C10.5 15.078125 10.542969 15.203125 10.632812 15.464844 11.128906 16.894531 13.070312 22.476562 17.5 18.015625c2.332031-2.351563 1.253906-4.699219-2.996094-5.40625 2.429688.40625 5.164063-.265625 5.914063-2.894531C20.632812 8.960938 21 4.304688 21 3.675781c0-3.152343-2.816406-2.160156-4.550781-.882812zm0 0"/></svg>
</a><a class="group -m-1 p-1 pointer-events-auto" aria-label="Follow on Mastodon" href=https://fosstodon.org/@cino rel=me target=_blank><svg viewBox="0 0 16 16" aria-hidden="true" class="h-6 w-6 fill-zinc-500 transition group-hover:fill-zinc-600 dark:fill-zinc-400 dark:group-hover:fill-zinc-300"><path fill="#828282" d="M15.659 9.592C15.424 10.72 13.553 11.956 11.404 12.195 10.283 12.32 9.18 12.434 8.003 12.384 6.079 12.302 4.56 11.956 4.56 11.956 4.56 12.13 4.572 12.297 4.595 12.452c.25 1.772 1.883 1.878 3.43 1.927C9.586 14.429 10.976 14.02 10.976 14.02L11.04 15.337S9.948 15.884 8.003 15.984C6.93 16.039 5.598 15.959 4.047 15.576.683 14.746.104 11.4.015 8.006-.012 6.998.005 6.048.005 5.253.005 1.782 2.443.765 2.443.765 3.672.238 5.782.017 7.975.0H8.029c2.192.017 4.303.238 5.532.765.0.0 2.438 1.017 2.438 4.488.0.0.0310000000000006 2.561-.34 4.339zm-2.535-4.07V9.725H11.339V5.646c0-.86-.388-1.296-1.164-1.296C9.317 4.35 8.887 4.867 8.887 5.891V8.124H7.113V5.891C7.113 4.867 6.683 4.35 5.825 4.35c-.776.0-1.164.436-1.164 1.296V9.725H2.876V5.522c0-.859.235-1.541.706-2.046.485-.505 1.121-.764 1.911-.764C6.406 2.712 7.098 3.039 7.555 3.695L8 4.39l.445-.695C8.902 3.039 9.594 2.712 10.507 2.712 11.297 2.712 11.933 2.971 12.418 3.476 12.889 3.981 13.124 4.663 13.124 5.522z" style="stroke:none;stroke-miterlimit:10;fill-rule:evenodd"/></svg>
</a><a class="group -m-1 p-1 pointer-events-auto" aria-label="Follow on GitHub" href=https://github.com/cino target=_blank><svg viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6 fill-zinc-500 transition group-hover:fill-zinc-600 dark:fill-zinc-400 dark:group-hover:fill-zinc-300"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2C6.475 2 2 6.588 2 12.253c0 4.537 2.862 8.369 6.838 9.727.5.09.687-.218.687-.487.0-.243-.013-1.05-.013-1.91C7 20.059 6.35 18.957 6.15 18.38c-.113-.295-.6-1.205-1.025-1.448-.35-.192-.85-.667-.013-.68.788-.012 1.35.744 1.538 1.051.9 1.551 2.338 1.116 2.912.846.088-.666.35-1.115.638-1.371-2.225-.256-4.55-1.14-4.55-5.062.0-1.115.387-2.038 1.025-2.756-.1-.256-.45-1.307.1-2.717.0.0.837-.269 2.75 1.051.8-.23 1.65-.346 2.5-.346s1.7.115 2.5.346c1.912-1.333 2.75-1.05 2.75-1.05.55 1.409.2 2.46.1 2.716.637.718 1.025 1.628 1.025 2.756.0 3.934-2.337 4.806-4.562 5.062.362.32.675.936.675 1.897.0 1.371-.013 2.473-.013 2.82.0.268.188.589.688.486a10.039 10.039.0 004.932-3.74A10.447 10.447.0 0022 12.253C22 6.588 17.525 2 12 2z"/></svg>
</a><a class="group -m-1 p-1 pointer-events-auto" aria-label="Follow on LinkedIn" href=https://www.linkedin.com/in/cinoricardo/ target=_blank><svg viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6 fill-zinc-500 transition group-hover:fill-zinc-600 dark:fill-zinc-400 dark:group-hover:fill-zinc-300"><path d="M18.335 18.339H15.67v-4.177c0-.996-.02-2.278-1.39-2.278-1.389.0-1.601 1.084-1.601 2.205v4.25h-2.666V9.75h2.56v1.17h.035c.358-.674 1.228-1.387 2.528-1.387 2.7.0 3.2 1.778 3.2 4.091v4.715zM7.003 8.575A1.546 1.546.0 015.455 7.026a1.548 1.548.0 111.547 1.549zm1.336 9.764H5.666V9.75H8.34v8.589zM19.67 3H4.329C3.593 3 3 3.58 3 4.297v15.406C3 20.42 3.594 21 4.328 21h15.338C20.4 21 21 20.42 21 19.703V4.297C21 3.58 20.4 3 19.666 3h.003z"/></svg></a></div></div></div></div></div></div></div></div></header><main><div class="sm:px-8 mt-16 lg:mt-32"><div class="mx-auto max-w-7xl lg:px-8"><div class="relative px-4 sm:px-8 lg:px-12"><div class="mx-auto max-w-2xl lg:max-w-5xl"><div class=xl:relative><div class="mx-auto max-w-2xl"><a href=/ aria-label="Go back to articles" class="group mb-8 flex h-10 w-10 items-center justify-center rounded-full bg-white shadow-md shadow-zinc-800/5 ring-1 ring-zinc-900/5 transition dark:border dark:border-zinc-700/50 dark:bg-zinc-800 dark:ring-0 dark:ring-white/10 dark:hover:border-zinc-700 dark:hover:ring-white/20 lg:absolute lg:-left-5 lg:mb-0 lg:-mt-2 xl:-top-1.5 xl:left-0 xl:mt-0"><svg viewBox="0 0 16 16" fill="none" aria-hidden="true" class="h-4 w-4 stroke-zinc-500 transition group-hover:stroke-zinc-700 dark:stroke-zinc-500 dark:group-hover:stroke-zinc-400"><path d="M7.25 11.25 3.75 8m0 0 3.5-3.25M3.75 8h8.5" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></a><article><header class="flex flex-col"><time datetime=2023-07-19 class="order-first flex items-center text-base text-zinc-400 dark:text-zinc-500"><span class="h-4 w-0.5 rounded-full bg-zinc-200 dark:bg-zinc-500"></span>
<span class=ml-3>July 19, 2023</span>
<span class="h-4 ml-4 w-0.5 rounded-full bg-zinc-200 dark:bg-zinc-500"></span>
<span class=ml-3>9 min read</span></time><div class="relative mt-4 text-zinc-400"><a href=/tags/aws/ class=hover:text-zinc-200>#aws</a>, <a href=/tags/amazon-web-services/ class=hover:text-zinc-200>#amazon web services</a>, <a href=/tags/parameter-store/ class=hover:text-zinc-200>#parameter store</a>, <a href=/tags/secrets/ class=hover:text-zinc-200>#secrets</a>, <a href=/tags/serverless/ class=hover:text-zinc-200>#serverless</a>, <a href=/tags/lambda/ class=hover:text-zinc-200>#lambda</a>, <a href=/tags/cloudwatch-event/ class=hover:text-zinc-200>#cloudwatch event</a>, <a href=/tags/rotation/ class=hover:text-zinc-200>#rotation</a></div><h1 class="mt-6 text-4xl font-bold tracking-tight text-zinc-800 dark:text-zinc-100 sm:text-5xl">AWS Parameter Store vs AWS Secrets</h1></header><div class="mt-8 prose dark:prose-invert"><p>Recently I&rsquo;ve been using AWS Secrets to retrieve API keys which are needed to access external API&rsquo;s, however, this turned out to be a more expensive service than we initially thought when starting.</p><picture><source media="(min-width: 600px)" srcset=/2023/aws-parameter-store-vs-aws-secrets/secrets-vs-parameter-store_hu_e17c19804fa9acf5.webp type=image/webp><source media="(min-width: 300px)" srcset=/2023/aws-parameter-store-vs-aws-secrets/secrets-vs-parameter-store_hu_bd5cb729cc8a44c1.webp type=image/webp><source media="(max-width: 300px)" srcset=/2023/aws-parameter-store-vs-aws-secrets/secrets-vs-parameter-store_hu_5979d3822d89da59.webp type=image/webp><img loading=lazy src=/2023/aws-parameter-store-vs-aws-secrets/secrets-vs-parameter-store_hu_89eb4e0f82c607e.png alt="Parameter Store vs Secrets" width=100% height=205></picture><h2 id=parameter-store-vs-secrets>Parameter Store vs Secrets</h2><p>When you need to store and use variables/secrets within AWS, you&rsquo;ll have several services at your disposal to ensure secure and efficient management. The two primary services for this purpose are AWS Systems Manager Parameter Store and AWS Secrets Manager. AWS Systems Manager Parameter Store is ideal for storing non-sensitive configuration data, such as database connection strings and application settings. It offers both plaintext and encrypted options, along with basic access control using IAM policies.</p><p>On the other hand, AWS Secrets Manager is specifically designed to handle sensitive information like API keys, database credentials, and other secrets. It automatically encrypts the data using AWS KMS and provides more granular access control through IAM policies, even allowing for secret rotation to enhance security. By choosing the appropriate service for your specific use case, you can ensure the protection of your variables and secrets while seamlessly integrating them into your AWS applications and services.</p><p>However, if you look at the encrypted option for Parameter Store and compare it with Secrets you&rsquo;ll quickly realize that when you <strong>don&rsquo;t&rsquo;</strong> make use of the rotation feature in AWS Secrets it is actually a very expensive Parameter Store.</p><p><em>All the code examples on this page are available as ready-to-deploy cdk on my <a href=https://github.com/cino/cdk-examples/tree/main/parameter-store-vs-secret target=_blank>CDK Examples</a> repository.</em></p><h2 id=why-use-parameter-store>Why use Parameter Store?</h2><p>The Parameter Store is a service that is used to store variables and secrets, it is a very simple service to use and it is very cheap. The Parameter Store is a service that is part of the AWS Systems Manager, this is a great place to store variables that you want to use in your code but don&rsquo;t want to hardcore. For example you could store the API key of a external service in the Parameter Store and retrieve it in your code, another example could be the identifiers/keys for specific resources in your AWS account.</p><p>Because you can retrieve this during rungtime (and cache them for limited time) you always the latest version of the parameter, compared to storing such values in Lambda Environments or in a file on the EC2 instance.</p><h2 id=when-to-use-aws-secrets>When to use AWS Secrets?</h2><p>What makes AWS Secrets such a powerfool tool is that it seamlessly integrates with a couple of Amazon products, for example you can easily use an AWS Secret to rotate the password of your Aurora instance without writing a single line of code. A couple of AWS Services that are supported by this are: Amazon RDS, Amazon DocumentDB and Amazon Redshift. Next to the out-of-the-box support services AWS also provides with a few rotation lambda templates on their <a href=https://github.com/aws-samples/aws-secrets-manager-rotation-lambdas/tree/master target=_blank>GitHub</a>.</p><p>In the case of a custom secret the only time to use AWS Secrets would be when you actually are rotating the values on a regular basis, the mechanism provided by Amazon is amazing and with automatic failure handling/retry handling it works better than with the Parameter Store.</p><p>For any secret you are not rotating I would advise to use the Parameter Store as this is much cheaper when you are using it a lot.</p><h2 id=but-you-can-also-rotate-the-value-with-parameter-store>But&mldr; you can also rotate the value with Parameter Store.</h2><p>Absolutely! This would however be a complete custom integration with a scheduled lambda that modifies the value of the Parameter. In fact this is the same thing that you do when using the Rotation feature of AWS Secrets except it is much more simplified. For starters you would need to deploy a Lambda Function with the permissions to read and write to the specific Parameter.</p><p>CDK:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#ff79c6>const</span> secretParameter <span style=color:#ff79c6>=</span> StringParameter.fromSecureStringParameterAttributes(<span style=color:#ff79c6>this</span>, <span style=color:#f1fa8c>&#39;mySecretRotatingParameter&#39;</span>, {
</span></span><span style=display:flex><span>  parameterName<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#39;/parameter-store-vs-secret/secret-rotating&#39;</span>,
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// It is not possible to get the output of the secret value from the AWS CDK.
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// However you can give lambda&#39;s permission to read/write the secret value.
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// In this example we will be rotating the secret every 5 minutes to demonstrate the rotation.
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>const</span> rotationLambda <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> NodejsFunction(<span style=color:#ff79c6>this</span>, <span style=color:#f1fa8c>&#39;rotationLambda&#39;</span>, {
</span></span><span style=display:flex><span>  entry: <span style=color:#8be9fd>join</span>(__dirname, <span style=color:#f1fa8c>&#39;./custom-rotation/main.ts&#39;</span>),
</span></span><span style=display:flex><span>  environment<span style=color:#ff79c6>:</span> {
</span></span><span style=display:flex><span>    PARAMETER_NAME: <span style=color:#8be9fd>secretParameter.parameterName</span>,
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  runtime: <span style=color:#8be9fd>Runtime.NODEJS_18_X</span>,
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>secretParameter.grantRead(rotationLambda);
</span></span><span style=display:flex><span>secretParameter.grantWrite(rotationLambda);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Schedule the rotation every 5 minutes using a CloudWatch Event Rule.
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>new</span> Rule(<span style=color:#ff79c6>this</span>, <span style=color:#f1fa8c>&#39;rotationRule&#39;</span>, {
</span></span><span style=display:flex><span>  schedule: <span style=color:#8be9fd>Schedule.rate</span>(Duration.minutes(<span style=color:#bd93f9>5</span>)),
</span></span><span style=display:flex><span>  targets<span style=color:#ff79c6>:</span> [
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>new</span> LambdaFunction(rotationLambda),
</span></span><span style=display:flex><span>  ],
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p><em>Source: <a href=https://github.com/cino/cdk-examples/blob/main/parameter-store-vs-secret/lib/parameter-store-secret-custom-rotation-stack.ts target=_blank>parameter-store-secret-custom-rotation-stack.ts</a></em></p><p>Lambda:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#ff79c6>export</span> <span style=color:#ff79c6>const</span> handler: <span style=color:#8be9fd>ScheduledHandler</span> <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>async</span> (
</span></span><span style=display:flex><span>  event: <span style=color:#8be9fd>ScheduledEvent</span>,
</span></span><span style=display:flex><span>)<span style=color:#ff79c6>:</span> Promise&lt;<span style=color:#ff79c6>void</span>&gt; <span style=color:#ff79c6>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> parameterName <span style=color:#ff79c6>=</span> process.env.PARAMETER_NAME <span style=color:#ff79c6>as</span> <span style=color:#8be9fd>string</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>await</span> ssmClient.send(<span style=color:#ff79c6>new</span> PutParameterCommand({
</span></span><span style=display:flex><span>    Name: <span style=color:#8be9fd>parameterName</span>,
</span></span><span style=display:flex><span>    Value: <span style=color:#8be9fd>new</span> <span style=color:#8be9fd;font-style:italic>Date</span>().toISOString(),
</span></span><span style=display:flex><span>    Overwrite: <span style=color:#8be9fd>true</span>,
</span></span><span style=display:flex><span>  }));
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This is however an extremely simplified version as this would only set the value to the latest date, in a real world example you could first generate an API key in a external service by calling an API and directly after that update the value in the Secure Parameter.</p><h2 id=secret-rotation-example>Secret Rotation Example</h2><p>In the case of AWS Secrets there is a specific feature that allows you to rotate the value of the secret, this is a very powerful feature that allows you to rotate the value of the secret without having to write any code. In the case of a custom secret you would need to write a custom lambda that would rotate the value of the secret, this is a lot more work than using the AWS Secrets Manager.</p><p>In the case of a custom secret I&rsquo;ve created an example lambda that I&rsquo;ve made available in a <a href=https://github.com/cino/typescript-lambda-examples/blob/main/src/secret-manager-rotation.ts target=_blank>special repository</a> and will also show below, first of all setting this up via CDK is very easy.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#ff79c6>const</span> customSecret <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> Secret(<span style=color:#ff79c6>this</span>, <span style=color:#f1fa8c>&#39;customSecret&#39;</span>, {
</span></span><span style=display:flex><span>  secretName<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#39;/parameter-store-vs-secret/secret-rotation-custom&#39;</span>,
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>customSecret.addRotationSchedule(<span style=color:#f1fa8c>&#39;RotationSchedule&#39;</span>, {
</span></span><span style=display:flex><span>  rotationLambda: <span style=color:#8be9fd>new</span> NodejsFunction(<span style=color:#ff79c6>this</span>, <span style=color:#f1fa8c>&#39;rotationLambda&#39;</span>, {
</span></span><span style=display:flex><span>    entry: <span style=color:#8be9fd>join</span>(__dirname, <span style=color:#f1fa8c>&#39;./custom-rotation-secret/main.ts&#39;</span>),
</span></span><span style=display:flex><span>    architecture: <span style=color:#8be9fd>Architecture.ARM_64</span>,
</span></span><span style=display:flex><span>    runtime: <span style=color:#8be9fd>Runtime.NODEJS_18_X</span>,
</span></span><span style=display:flex><span>    timeout: <span style=color:#8be9fd>Duration.seconds</span>(<span style=color:#bd93f9>30</span>),
</span></span><span style=display:flex><span>  }),
</span></span><span style=display:flex><span>  automaticallyAfter: <span style=color:#8be9fd>Duration.days</span>(<span style=color:#bd93f9>1</span>),
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p>Instead of the need to create a seperate CloudWatch Event Rule and Lambda Function you can simply add the rotation schedule to the secret. This will automatically create the CloudWatch Event Rule and Lambda Function for you with the correct permissions to be able to retrieve/store the secret.</p><p>The lambda function will actually be a bit more complex than with the Parameter Store as there are 4 different events that you need to handle, these are:</p><ul><li>createSecret<ul><li>This event is triggered at the start of the process where a new version of the secret will be created with a new value. This can either be generated or retrieved from a external service.</li></ul></li><li>setSecret<ul><li>This event is triggered after the createSecret event and will be the phase where you would persist the secret value in a external service to be able to authenticate with it.</li></ul></li><li>testSecret<ul><li>After setting the secret in the external service you will need to test if the secret is valid, this is done by calling the external service with the new secret value and see if the authentication is done properly. Additionally you can also include some extra authorization checks.</li></ul></li><li>finishSecret<ul><li>The last and final step is where you would change the state of the new secret to &lsquo;AWSCURRENT&rsquo; and remove the old version of the secret, only in this step, after the testing phase the new secret will be used.</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#ff79c6>async</span> <span style=color:#8be9fd;font-style:italic>function</span> createSecret(
</span></span><span style=display:flex><span>  arn: <span style=color:#8be9fd>string</span>,
</span></span><span style=display:flex><span>  token: <span style=color:#8be9fd>string</span>,
</span></span><span style=display:flex><span>)<span style=color:#ff79c6>:</span> Promise&lt;<span style=color:#ff79c6>void</span>&gt; {
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// Check if the current version exists
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#ff79c6>await</span> secretsClient.send(
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>new</span> GetSecretValueCommand({
</span></span><span style=display:flex><span>      SecretId: <span style=color:#8be9fd>arn</span>,
</span></span><span style=display:flex><span>      VersionStage<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#39;AWSCURRENT&#39;</span>,
</span></span><span style=display:flex><span>    }),
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>try</span> {
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Check if the pending version exists otherwise create a new one
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>await</span> secretsClient.send(
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>new</span> GetSecretValueCommand({
</span></span><span style=display:flex><span>        SecretId: <span style=color:#8be9fd>arn</span>,
</span></span><span style=display:flex><span>        VersionStage<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#39;AWSPENDING&#39;</span>,
</span></span><span style=display:flex><span>      }),
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    console.log(<span style=color:#f1fa8c>`Secret version </span><span style=color:#f1fa8c>${</span>token<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c> already exists for secret </span><span style=color:#f1fa8c>${</span>arn<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>`</span>);
</span></span><span style=display:flex><span>  } <span style=color:#ff79c6>catch</span> (exception) {
</span></span><span style=display:flex><span>    <span style=color:#6272a4>/**
</span></span></span><span style=display:flex><span><span style=color:#6272a4>     * Here we would create a new secret / create a new API key in an external service and create a new secret version.
</span></span></span><span style=display:flex><span><span style=color:#6272a4>     *
</span></span></span><span style=display:flex><span><span style=color:#6272a4>     * For this demo purpose we are going to create a new secret version with a random string
</span></span></span><span style=display:flex><span><span style=color:#6272a4>     */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>const</span> randomString <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>Math</span>.random().toString(<span style=color:#bd93f9>36</span>).substring(<span style=color:#bd93f9>2</span>, <span style=color:#bd93f9>15</span>) <span style=color:#ff79c6>+</span> <span style=color:#8be9fd;font-style:italic>Math</span>.random().toString(<span style=color:#bd93f9>36</span>).substring(<span style=color:#bd93f9>2</span>, <span style=color:#bd93f9>15</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// If the current version does not exist, create a new one
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>await</span> secretsClient.send(
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>new</span> PutSecretValueCommand({
</span></span><span style=display:flex><span>        SecretId: <span style=color:#8be9fd>arn</span>,
</span></span><span style=display:flex><span>        ClientRequestToken: <span style=color:#8be9fd>token</span>,
</span></span><span style=display:flex><span>        SecretString: <span style=color:#8be9fd>randomString</span>,
</span></span><span style=display:flex><span>        VersionStages<span style=color:#ff79c6>:</span> [<span style=color:#f1fa8c>&#39;AWSPENDING&#39;</span>],
</span></span><span style=display:flex><span>      }),
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    console.log(<span style=color:#f1fa8c>`Secret version </span><span style=color:#f1fa8c>${</span>token<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c> created for secret </span><span style=color:#f1fa8c>${</span>arn<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>`</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>async</span> <span style=color:#8be9fd;font-style:italic>function</span> setSecret()<span style=color:#ff79c6>:</span> Promise&lt;<span style=color:#ff79c6>void</span>&gt; {
</span></span><span style=display:flex><span>  <span style=color:#6272a4>/**
</span></span></span><span style=display:flex><span><span style=color:#6272a4>   *
</span></span></span><span style=display:flex><span><span style=color:#6272a4>   * Set the secret in the external application / service unless the token has been generated
</span></span></span><span style=display:flex><span><span style=color:#6272a4>   * by the previous step by using an api.
</span></span></span><span style=display:flex><span><span style=color:#6272a4>   *
</span></span></span><span style=display:flex><span><span style=color:#6272a4>   */</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>async</span> <span style=color:#8be9fd;font-style:italic>function</span> testSecret()<span style=color:#ff79c6>:</span> Promise&lt;<span style=color:#ff79c6>void</span>&gt; {
</span></span><span style=display:flex><span>  <span style=color:#6272a4>/**
</span></span></span><span style=display:flex><span><span style=color:#6272a4>   *
</span></span></span><span style=display:flex><span><span style=color:#6272a4>   * Test if the secret is working and the correct permissions are set in the external application / service
</span></span></span><span style=display:flex><span><span style=color:#6272a4>   *
</span></span></span><span style=display:flex><span><span style=color:#6272a4>   */</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>async</span> <span style=color:#8be9fd;font-style:italic>function</span> finishSecret(
</span></span><span style=display:flex><span>  arn: <span style=color:#8be9fd>string</span>,
</span></span><span style=display:flex><span>  token: <span style=color:#8be9fd>string</span>,
</span></span><span style=display:flex><span>)<span style=color:#ff79c6>:</span> Promise&lt;<span style=color:#ff79c6>void</span>&gt; {
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> metaData <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>await</span> secretsClient.send(
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>new</span> DescribeSecretCommand({
</span></span><span style=display:flex><span>      SecretId: <span style=color:#8be9fd>arn</span>,
</span></span><span style=display:flex><span>    }),
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// Check if the current version is already set correctly and stop the process.
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#8be9fd;font-style:italic>let</span> currentVersion: <span style=color:#8be9fd>string</span> <span style=color:#ff79c6>|</span> <span style=color:#ff79c6>undefined</span> <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>undefined</span>;
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>if</span> (metaData.VersionIdsToStages) {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span> (<span style=color:#ff79c6>const</span> version <span style=color:#ff79c6>in</span> metaData.VersionIdsToStages) {
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>if</span> (metaData.VersionIdsToStages[version].includes(<span style=color:#f1fa8c>&#39;AWSCURRENT&#39;</span>)) {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> (version <span style=color:#ff79c6>===</span> token) {
</span></span><span style=display:flex><span>          console.log(<span style=color:#f1fa8c>`Version </span><span style=color:#f1fa8c>${</span>version<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c> is already set as AWSCURRENT for secret </span><span style=color:#f1fa8c>${</span>arn<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>`</span>)
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>return</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        currentVersion <span style=color:#ff79c6>=</span> version;
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>break</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// If not finialize the secret rotation process
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#ff79c6>await</span> secretsClient.send(
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>new</span> UpdateSecretVersionStageCommand({
</span></span><span style=display:flex><span>      SecretId: <span style=color:#8be9fd>arn</span>,
</span></span><span style=display:flex><span>      VersionStage<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#39;AWSCURRENT&#39;</span>,
</span></span><span style=display:flex><span>      MoveToVersionId: <span style=color:#8be9fd>token</span>,
</span></span><span style=display:flex><span>      RemoveFromVersionId: <span style=color:#8be9fd>currentVersion</span>,
</span></span><span style=display:flex><span>    }),
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  console.log(<span style=color:#f1fa8c>&#39;Secret rotation process finished&#39;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>export</span> <span style=color:#ff79c6>const</span> handler: <span style=color:#8be9fd>SecretsManagerRotationHandler</span> <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>async</span> (
</span></span><span style=display:flex><span>  event: <span style=color:#8be9fd>SecretsManagerRotationEvent</span>,
</span></span><span style=display:flex><span>)<span style=color:#ff79c6>:</span> Promise&lt;<span style=color:#ff79c6>void</span>&gt; <span style=color:#ff79c6>=&gt;</span> {
</span></span><span style=display:flex><span>  console.log(JSON.stringify(event));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> arn <span style=color:#ff79c6>=</span> event.SecretId;
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> token <span style=color:#ff79c6>=</span> event.ClientRequestToken;
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> step <span style=color:#ff79c6>=</span> event.Step;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> metadata <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>await</span> secretsClient.send(
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>new</span> DescribeSecretCommand({
</span></span><span style=display:flex><span>      SecretId: <span style=color:#8be9fd>arn</span>,
</span></span><span style=display:flex><span>    }),
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>if</span> (metadata.RotationEnabled <span style=color:#ff79c6>!==</span> <span style=color:#ff79c6>true</span>) {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>throw</span> <span style=color:#ff79c6>new</span> <span style=color:#8be9fd;font-style:italic>Error</span>(<span style=color:#f1fa8c>`Secret </span><span style=color:#f1fa8c>${</span>arn<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c> is not enabled for rotation`</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> versions <span style=color:#ff79c6>=</span> metadata.VersionIdsToStages;
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>if</span> (versions) {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> (token <span style=color:#ff79c6>in</span> versions <span style=color:#ff79c6>===</span> <span style=color:#ff79c6>false</span>) {
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>throw</span> <span style=color:#ff79c6>new</span> <span style=color:#8be9fd;font-style:italic>Error</span>(<span style=color:#f1fa8c>`Secret version </span><span style=color:#f1fa8c>${</span>token<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c> has no stage for rotation of secret </span><span style=color:#f1fa8c>${</span>arn<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>.`</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> (versions[token].includes(<span style=color:#f1fa8c>&#39;AWSCURRENT&#39;</span>)) {
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>throw</span> <span style=color:#ff79c6>new</span> <span style=color:#8be9fd;font-style:italic>Error</span>(<span style=color:#f1fa8c>`Secret version </span><span style=color:#f1fa8c>${</span>token<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c> already set as AWSCURRENT for secret </span><span style=color:#f1fa8c>${</span>arn<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>.`</span>);
</span></span><span style=display:flex><span>    } <span style=color:#ff79c6>else</span> <span style=color:#ff79c6>if</span> (versions[token].includes(<span style=color:#f1fa8c>&#39;AWSPENDING&#39;</span>) <span style=color:#ff79c6>===</span> <span style=color:#ff79c6>false</span> <span style=color:#ff79c6>&amp;&amp;</span> step <span style=color:#ff79c6>!==</span> <span style=color:#f1fa8c>&#34;createSecret&#34;</span>) {
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>throw</span> <span style=color:#ff79c6>new</span> <span style=color:#8be9fd;font-style:italic>Error</span>(<span style=color:#f1fa8c>`Secret version </span><span style=color:#f1fa8c>${</span>token<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c> not set as AWSPENDING for rotation of secret </span><span style=color:#f1fa8c>${</span>arn<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>.`</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>switch</span> (step) {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>case</span> <span style=color:#f1fa8c>&#34;createSecret&#34;</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>await</span> createSecret(arn, token);
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>break</span>;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>case</span> <span style=color:#f1fa8c>&#34;setSecret&#34;</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>await</span> setSecret();
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>break</span>;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>case</span> <span style=color:#f1fa8c>&#34;testSecret&#34;</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>await</span> testSecret();
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>break</span>;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>case</span> <span style=color:#f1fa8c>&#34;finishSecret&#34;</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>await</span> finishSecret(arn, token);
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>break</span>;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>default</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>throw</span> <span style=color:#ff79c6>new</span> <span style=color:#8be9fd;font-style:italic>Error</span>(<span style=color:#f1fa8c>`Unsupported step &#34;</span><span style=color:#f1fa8c>${</span>step<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>&#34;`</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>return</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=pricing>Pricing</h2><p>Here we go, with AWS it&rsquo;s always about pricing. Especially since there is a <a href=https://docs.aws.amazon.com/wellarchitected/latest/cost-optimization-pillar/welcome.html target=_blank>specific pillar</a> about it. So let&rsquo;s take a look at the pricing of both services.</p><table><tr><td><strong>Service</strong></td><td><strong>Count</strong></td><td><strong>Requests</strong></td><td><strong>Price</strong></td></tr><tr><td>Parameter Store</td><td>25</td><td>10,000</td><td>$0.00</td></tr><tr><td>Secrets</td><td>25</td><td>10,000</td><td>$10.05</td></tr></table><p>As you can see in the comparison calculated by <a href=https://calculator.aws target=_blank>calculator.aws</a> the Parameter Store is a lot cheaper than the Secrets Manager. This is because the Secrets Manager is a lot more feature rich and has a lot more functionality than the Parameter Store. However, if you are not using the rotation feature of the Secrets Manager you are paying a lot more for the same functionality.</p></div></article></div></div></div></div></div></div></main><footer class=mt-32><div class=sm:px-8><div class="mx-auto max-w-7xl lg:px-8"><div class="border-t border-zinc-100 pt-10 pb-16 0"><div class="relative px-4 sm:px-8 lg:px-12"><div class="mx-auto max-w-2xl lg:max-w-5xl"><div class="flex flex-col items-center justify-between gap-6 sm:flex-row"><div class="flex gap-6 text-sm font-medium text-zinc-800"><a class="transition hover:text-teal-500" href=/>Home</a></div><p class="text-sm text-zinc-400">© 2025 Cino Consultancy<br><span class=text-xs>KVK: 89913019</span></p></div></div></div></div></div></div></footer></div></body></html>