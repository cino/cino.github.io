<!doctype html><html class="h-full antialiased" style=--header-position:sticky;--content-offset:0px;--header-height:64px;--header-mb:0px;--header-top:0px;--avatar-top:0px lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Avoiding CloudFormation Stack Outputs - Cino</title><link rel=canonical href=https://cino.io/2024/avoid-cloudformation-stack-outputs/><link rel=alternate type=application/rss+xml title=RSS href=https://cino.io/index.xml><link rel=apple-touch-icon sizes=57x57 href=/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=/android-icon-192x192.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><meta name=msapplication-TileColor content="#ffffff"><meta name=msapplication-TileImage content="/ms-icon-144x144.png"><meta name=theme-color content="#ffffff"><meta property="og:url" content="https://cino.io/2024/avoid-cloudformation-stack-outputs/"><meta property="og:site_name" content="Cino"><meta property="og:title" content="Avoiding CloudFormation Stack Outputs"><meta property="og:description" content="Recently I’ve been working on a new project where we created many resources in a lot of different stacks. A feature of CloudFormation is that you can output values from your stack, which is great for referencing resources in other stacks. However, while there is a use-case for this, I’ve found that it’s better to avoid using these outputs and instead use SSM parameters."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="2024"><meta property="article:published_time" content="2024-11-11T00:00:00+00:00"><meta property="article:modified_time" content="2024-11-11T00:00:00+00:00"><meta property="article:tag" content="Aws"><meta property="article:tag" content="Amazon Web Services"><meta property="article:tag" content="Cloudformation"><meta property="article:tag" content="Tags/Stacks"><meta property="article:tag" content="Tags/Outputs"><meta property="article:tag" content="Ssm Parameters"><meta property="og:image" content="https://cino.io/2024/avoid-cloudformation-stack-outputs/datastack-output.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://cino.io/2024/avoid-cloudformation-stack-outputs/datastack-output.png"><meta name=twitter:title content="Avoiding CloudFormation Stack Outputs"><meta name=twitter:description content="Recently I’ve been working on a new project where we created many resources in a lot of different stacks. A feature of CloudFormation is that you can output values from your stack, which is great for referencing resources in other stacks. However, while there is a use-case for this, I’ve found that it’s better to avoid using these outputs and instead use SSM parameters."><meta itemprop=name content="Avoiding CloudFormation Stack Outputs"><meta itemprop=description content="Recently I’ve been working on a new project where we created many resources in a lot of different stacks. A feature of CloudFormation is that you can output values from your stack, which is great for referencing resources in other stacks. However, while there is a use-case for this, I’ve found that it’s better to avoid using these outputs and instead use SSM parameters."><meta itemprop=datePublished content="2024-11-11T00:00:00+00:00"><meta itemprop=dateModified content="2024-11-11T00:00:00+00:00"><meta itemprop=wordCount content="1008"><meta itemprop=image content="https://cino.io/2024/avoid-cloudformation-stack-outputs/datastack-output.png"><meta itemprop=keywords content="Aws,Amazon Web Services,Cloudformation,Tags/Stacks,Tags/Outputs,Ssm Parameters,Aws Cdk,Aws Cloud Development Kit,Infrastructure as Code,Iac"><link rel=stylesheet href="https://cino.io/css/styles.min.22a35d5eab0e3ecf0d2ceed15f1d08547695057ed928ec4acddf4e7ac8648203.css" integrity="sha256-IqNdXqsOPs8NLO7RXx0IVHaVBX7ZKOxKzd9OeshkggM="><meta name=fediverse:creator content="@cino@fosstodon.org"><script async src="https://www.googletagmanager.com/gtag/js?id=G-GCGJ9S1XSX"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-GCGJ9S1XSX")}</script></head><body class="flex h-full flex-col bg-zinc-50"><div class="fixed inset-0 flex justify-center sm:px-8"><div class="flex w-full max-w-7xl lg:px-8"><div class="w-full bg-white ring-1 ring-zinc-100"></div></div></div><div class=relative><header class="pointer-events-none relative z-50 flex flex-col" style=height:var(--header-height);margin-bottom:var(--header-mb)><div class="top-0 z-10 h-16 pt-6" style=position:var(--header-position)><div class="sm:px-8 top-[var(--header-top,theme(spacing.6))] w-full" style=position:var(--header-inner-position)><div class="mx-auto max-w-7xl lg:px-8"><div class="relative px-4 sm:px-8 lg:px-12"><div class="mx-auto max-w-2xl lg:max-w-5xl"><div class="relative flex gap-4"><div class="flex flex-1"><div class="h-10 w-10 rounded-full bg-white/90 p-0.5 shadow-lg shadow-zinc-800/5 ring-1 ring-zinc-900/5 backdrop-blur"><a aria-label=Home class=pointer-events-auto href=https://cino.io/><img alt sizes=2.25rem src=/img/ricardo-cino-36x36.png decoding=async data-nimg=1 class="rounded-full bg-zinc-100 object-cover h-9 w-9" style=color:transparent width=512 height=512 alt="Ricardo Cino"></a></div></div><div class="relative flex justify-end flex-1"><div class="mt-2 flex gap-6"><a class="group -m-1 p-1 pointer-events-auto" aria-label="Follow on Bluesky" href=https://bsky.app/profile/cino.io target=_blank><svg viewBox="0 0 24 24" width="24" height="24" class="h-6 w-6 fill-zinc-500 transition group-hover:fill-zinc-600 dark:fill-zinc-400 dark:group-hover:fill-zinc-300"><path style="stroke:none;fill-rule:nonzero" d="M4.550781 2.792969c2.410157 1.773437 5 5.371093 5.949219 7.296875V15.1875C10.5 15.078125 10.457031 15.203125 10.367188 15.464844 9.871094 16.894531 7.929688 22.476562 3.5 18.015625c-2.332031-2.351563-1.253906-4.699219 2.996094-5.40625-2.429688.40625-5.164063-.265625-5.914063-2.894531C.367188 8.960938.0 4.304688.0 3.675781.0.523438 2.816406 1.515625 4.550781 2.792969zm11.898438.0c-2.410157 1.773437-5 5.371093-5.949219 7.296875V15.1875C10.5 15.078125 10.542969 15.203125 10.632812 15.464844 11.128906 16.894531 13.070312 22.476562 17.5 18.015625c2.332031-2.351563 1.253906-4.699219-2.996094-5.40625 2.429688.40625 5.164063-.265625 5.914063-2.894531C20.632812 8.960938 21 4.304688 21 3.675781c0-3.152343-2.816406-2.160156-4.550781-.882812zm0 0"/></svg>
</a><a class="group -m-1 p-1 pointer-events-auto" aria-label="Follow on Mastodon" href=https://fosstodon.org/@cino rel=me target=_blank><svg viewBox="0 0 16 16" aria-hidden="true" class="h-6 w-6 fill-zinc-500 transition group-hover:fill-zinc-600 dark:fill-zinc-400 dark:group-hover:fill-zinc-300"><path fill="#828282" d="M15.659 9.592C15.424 10.72 13.553 11.956 11.404 12.195 10.283 12.32 9.18 12.434 8.003 12.384 6.079 12.302 4.56 11.956 4.56 11.956 4.56 12.13 4.572 12.297 4.595 12.452c.25 1.772 1.883 1.878 3.43 1.927C9.586 14.429 10.976 14.02 10.976 14.02L11.04 15.337S9.948 15.884 8.003 15.984C6.93 16.039 5.598 15.959 4.047 15.576.683 14.746.104 11.4.015 8.006-.012 6.998.005 6.048.005 5.253.005 1.782 2.443.765 2.443.765 3.672.238 5.782.017 7.975.0H8.029c2.192.017 4.303.238 5.532.765.0.0 2.438 1.017 2.438 4.488.0.0.0310000000000006 2.561-.34 4.339zm-2.535-4.07V9.725H11.339V5.646c0-.86-.388-1.296-1.164-1.296C9.317 4.35 8.887 4.867 8.887 5.891V8.124H7.113V5.891C7.113 4.867 6.683 4.35 5.825 4.35c-.776.0-1.164.436-1.164 1.296V9.725H2.876V5.522c0-.859.235-1.541.706-2.046.485-.505 1.121-.764 1.911-.764C6.406 2.712 7.098 3.039 7.555 3.695L8 4.39l.445-.695C8.902 3.039 9.594 2.712 10.507 2.712 11.297 2.712 11.933 2.971 12.418 3.476 12.889 3.981 13.124 4.663 13.124 5.522z" style="stroke:none;stroke-miterlimit:10;fill-rule:evenodd"/></svg>
</a><a class="group -m-1 p-1 pointer-events-auto" aria-label="Follow on GitHub" href=https://github.com/cino target=_blank><svg viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6 fill-zinc-500 transition group-hover:fill-zinc-600 dark:fill-zinc-400 dark:group-hover:fill-zinc-300"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2C6.475 2 2 6.588 2 12.253c0 4.537 2.862 8.369 6.838 9.727.5.09.687-.218.687-.487.0-.243-.013-1.05-.013-1.91C7 20.059 6.35 18.957 6.15 18.38c-.113-.295-.6-1.205-1.025-1.448-.35-.192-.85-.667-.013-.68.788-.012 1.35.744 1.538 1.051.9 1.551 2.338 1.116 2.912.846.088-.666.35-1.115.638-1.371-2.225-.256-4.55-1.14-4.55-5.062.0-1.115.387-2.038 1.025-2.756-.1-.256-.45-1.307.1-2.717.0.0.837-.269 2.75 1.051.8-.23 1.65-.346 2.5-.346s1.7.115 2.5.346c1.912-1.333 2.75-1.05 2.75-1.05.55 1.409.2 2.46.1 2.716.637.718 1.025 1.628 1.025 2.756.0 3.934-2.337 4.806-4.562 5.062.362.32.675.936.675 1.897.0 1.371-.013 2.473-.013 2.82.0.268.188.589.688.486a10.039 10.039.0 004.932-3.74A10.447 10.447.0 0022 12.253C22 6.588 17.525 2 12 2z"/></svg>
</a><a class="group -m-1 p-1 pointer-events-auto" aria-label="Follow on LinkedIn" href=https://www.linkedin.com/in/cinoricardo/ target=_blank><svg viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6 fill-zinc-500 transition group-hover:fill-zinc-600 dark:fill-zinc-400 dark:group-hover:fill-zinc-300"><path d="M18.335 18.339H15.67v-4.177c0-.996-.02-2.278-1.39-2.278-1.389.0-1.601 1.084-1.601 2.205v4.25h-2.666V9.75h2.56v1.17h.035c.358-.674 1.228-1.387 2.528-1.387 2.7.0 3.2 1.778 3.2 4.091v4.715zM7.003 8.575A1.546 1.546.0 015.455 7.026a1.548 1.548.0 111.547 1.549zm1.336 9.764H5.666V9.75H8.34v8.589zM19.67 3H4.329C3.593 3 3 3.58 3 4.297v15.406C3 20.42 3.594 21 4.328 21h15.338C20.4 21 21 20.42 21 19.703V4.297C21 3.58 20.4 3 19.666 3h.003z"/></svg></a></div></div></div></div></div></div></div></div></header><main><div class="sm:px-8 mt-16 lg:mt-32"><div class="mx-auto max-w-7xl lg:px-8"><div class="relative px-4 sm:px-8 lg:px-12"><div class="mx-auto max-w-2xl lg:max-w-5xl"><div class=xl:relative><div class="mx-auto max-w-2xl"><a href=/ aria-label="Go back to articles" class="group mb-8 flex h-10 w-10 items-center justify-center rounded-full bg-white shadow-md shadow-zinc-800/5 ring-1 ring-zinc-900/5 transition dark:border dark:border-zinc-700/50 dark:bg-zinc-800 dark:ring-0 dark:ring-white/10 dark:hover:border-zinc-700 dark:hover:ring-white/20 lg:absolute lg:-left-5 lg:mb-0 lg:-mt-2 xl:-top-1.5 xl:left-0 xl:mt-0"><svg viewBox="0 0 16 16" fill="none" aria-hidden="true" class="h-4 w-4 stroke-zinc-500 transition group-hover:stroke-zinc-700 dark:stroke-zinc-500 dark:group-hover:stroke-zinc-400"><path d="M7.25 11.25 3.75 8m0 0 3.5-3.25M3.75 8h8.5" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></a><article><header class="flex flex-col"><time datetime=2024-11-11 class="order-first flex items-center text-base text-zinc-400 dark:text-zinc-500"><span class="h-4 w-0.5 rounded-full bg-zinc-200 dark:bg-zinc-500"></span>
<span class=ml-3>November 11, 2024</span>
<span class="h-4 ml-4 w-0.5 rounded-full bg-zinc-200 dark:bg-zinc-500"></span>
<span class=ml-3>5 min read</span></time><div class="relative mt-4 text-zinc-400"><a href=/tags/aws/ class=hover:text-zinc-200>#aws</a>, <a href=/tags/amazon-web-services/ class=hover:text-zinc-200>#amazon web services</a>, <a href=/tags/cloudformation/ class=hover:text-zinc-200>#cloudformation</a>, <a href=/tags/stacks/ class=hover:text-zinc-200>#stacks</a>, <a href=/tags/outputs/ class=hover:text-zinc-200>#outputs</a>, <a href=/tags/ssm-parameters/ class=hover:text-zinc-200>#ssm parameters</a>, <a href=/tags/aws-cdk/ class=hover:text-zinc-200>#aws cdk</a>, <a href=/tags/aws-cloud-development-kit/ class=hover:text-zinc-200>#aws cloud development kit</a>, <a href=/tags/infrastructure-as-code/ class=hover:text-zinc-200>#infrastructure as code</a>, <a href=/tags/iac/ class=hover:text-zinc-200>#iac</a></div><h1 class="mt-6 text-4xl font-bold tracking-tight text-zinc-800 dark:text-zinc-100 sm:text-5xl">Avoiding CloudFormation Stack Outputs</h1></header><div class="mt-8 prose dark:prose-invert"><p>Recently I&rsquo;ve been working on a new project where we created many resources in a lot of different stacks. A feature of CloudFormation is that you can output values from your stack, which is great for referencing resources in other stacks. However, while there is a use-case for this, I&rsquo;ve found that it&rsquo;s better to avoid using these outputs and instead use SSM parameters.</p><h2 id=why-avoid-outputs>Why avoid outputs?</h2><p>There is a simple reason for me to avoid using outputs and that is <strong>dependencies</strong>. When you output a value and import it an a different stack you create a hard dependency between the two stacks. This means that you can&rsquo;t delete the stack that is being referenced without first deleting the stack that is referencing it.</p><p>Even better, you can&rsquo;t remove the stack output without first deleting the stack that is referencing it. This is a problem when you want to remove a resource from a stack, even when you are updating multiple stacks at the same time it will fail because of the dependency, in many cases it will try to update the stack which has the resource which is used for output first before the second stack where it is referenced. Even when the second stack wouldn&rsquo;t need the output anymore in that same deploy it will still cause a reference issue due to the order of the updates.</p><p>This is good right? Well, yes. There is an absolute case to be made where this gives you safety and stops you from deleting resources that are still in use. However, in my case:</p><ul><li>We are deploying stacks often while making test environments and we want to be able to remove resources without having to delete all the stacks that are referencing it all-the-time.</li><li>When you actually have an issue in production, dealing with stack dependencies is not something you want to be doing at that time.</li><li>Destroying all your stacks can take a long time as they need to be deleted in the correct order.</li></ul><h2 id=surprise-outputs-by-aws-cdk>Surprise outputs by AWS CDK</h2><p>If you are using AWS CDK for your infrastructure as code you might be surprised by the many outputs that you are using! This is because when you reference a Construct in another stack it will automatically output the identifier of the resource. This is a nice feature but it can also be a surprise when you are not expecting it. Even though you might be thinking that you are not using outputs, you are.</p><p>For example when you deploy the following stacks, in this example we are deploying 2 resources in different stacks, there is a DynamoDB table in the DataStack and a single Lambda function in the AppStack. The Lambda function has been given the permissions to read the DynamoDB table by passing it into the next stack and calling <code>table.grantReadData(lambda)</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#ff79c6>const</span> { table } <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> DataStack(app, <span style=color:#f1fa8c>&#34;DataStack&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#ff79c6>new</span> AppStack(app, <span style=color:#f1fa8c>&#34;AppStack&#34;</span>, { table });
</span></span></code></pre></div><p><em>Full example: <a href=https://github.com/cino/cdk-examples/blob/main/avoid-cloudformation-outputs/lib/stacks/example-with-stack-outputs.ts>example-with-stack-outputs.ts</a></em></p><p>When building your infrastructure in this way you will see that the CDK will automatically output the identifier of the DynamoDB table in CloudFormation.</p><picture><source media="(min-width: 600px)" srcset=/2024/avoid-cloudformation-stack-outputs/datastack-output_hu_443d440921811509.webp type=image/webp><source media="(min-width: 300px)" srcset=/2024/avoid-cloudformation-stack-outputs/datastack-output_hu_c4dd3f8984c3d17d.webp type=image/webp><source media="(max-width: 300px)" srcset=/2024/avoid-cloudformation-stack-outputs/datastack-output_hu_f0e9366d7ac2f4fa.webp type=image/webp><img loading=lazy src=/2024/avoid-cloudformation-stack-outputs/datastack-output_hu_1ff3848b3cab1e0.png alt="CloudFormation stack output example" width=100% height=243></picture><p>This value is imported by the AppStack during the synthesize phase and used to retrieve the DynamoDB Table. Now you have a hard dependency between the two stacks. When we now try to delete the AppStack we will get the following error:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#ff79c6>const</span> { table } <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> DataStack(app, <span style=color:#f1fa8c>&#34;DataStack&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#6272a4>// new AppStack(app, &#34;AppStack&#34;, { table });
</span></span></span></code></pre></div><blockquote><p>Delete canceled. Cannot delete export DataStack:ExportsOutputFnGetAttDataStackTableB5A722F5ArnBE341008 as it is in use by AppStack.</p></blockquote><p>You&rsquo;ll see that it now automatically tries to delete the created Output as it is not longer in use by the AppStack, however because CDK now doesn&rsquo;t have a notion of the AppStack it will only try to perform an update on the DataStack which will fail because the AppStack is still referencing it.</p><p>This is just a small example of how you can get into trouble with outputs without even knowing it.</p><h2 id=how-to-avoid-this>How to avoid this?</h2><p>A pattern to avoid this is to store identifiers in SSM parameters. This way you can reference the SSM parameter in your other stacks and you can delete the resource without having to delete the stack that is referencing it. This does mean that when you delete the resource you will have to make sure that your other stacks don&rsquo;t depend on it anymore, giving you more risk of deleting resources that are still in use.</p><p>Personally for me this risk is worth it as you can still create dependencies between stacks during deployment like the example below. This way you are ensured that the resources are created in the correct order without having CloudFormation outputs and hard dependencies.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#ff79c6>const</span> dataStack <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> DataStackWithSsmParameters(app, <span style=color:#f1fa8c>&#34;DataStackWithSsmParameters&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> appStack <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> AppStackWithSsmParameters(app, <span style=color:#f1fa8c>&#34;AppStackWithSsmParameters&#34;</span>);
</span></span><span style=display:flex><span>appStack.addDependency(dataStack);
</span></span></code></pre></div><p><em>Full example: <a href=https://github.com/cino/cdk-examples/blob/main/avoid-cloudformation-outputs/lib/stacks/example-with-ssm-parameters.ts>example-with-ssm-parameters.ts</a></em></p><h2 id=conclusion>Conclusion</h2><p>If you are using CloudFormation (or CDK) you can avoid finding yourself in a situation where you can&rsquo;t update a stack because of a reference to another stack by using SSM parameters instead of outputs. This way you can delete resources without having to delete the stacks that are referencing them.</p><p>In all the projects I&rsquo;m working on myself I will not be using any outputs anymore and will be using SSM parameters instead. I&rsquo;ve been hurt too many times with the hard dependencies between stacks and the time it takes to delete all the stacks in the correct order.</p><p>At 1 of the projects I had to delete 10+ stacks which would take more than 1 hour in a pipeline due to the dependencies between the stacks. Removing these outputs and importing the values from SSM Parameters decreased the time to delete all the stacks to ~20 minutes. I admit this is still a long time but this is because there was a CloudFront and Fargate container in the codebase. (Cloudfront being the longest to delete)</p><table><thead><tr><th>✅ Pros</th><th>❌ Cons</th></tr></thead><tbody><tr><td>Less conflicts when updating your stacks</td><td>Less &ldquo;safety&rdquo; out of the box from CloudFormation</td></tr><tr><td>Faster deletion of all your stacks in test environments</td><td>Needing to place dependencies between stacks yourself</td></tr></tbody></table></div></article></div></div></div></div></div></div></main><footer class=mt-32><div class=sm:px-8><div class="mx-auto max-w-7xl lg:px-8"><div class="border-t border-zinc-100 pt-10 pb-16 0"><div class="relative px-4 sm:px-8 lg:px-12"><div class="mx-auto max-w-2xl lg:max-w-5xl"><div class="flex flex-col items-center justify-between gap-6 sm:flex-row"><div class="flex gap-6 text-sm font-medium text-zinc-800"><a class="transition hover:text-teal-500" href=/>Home</a></div><p class="text-sm text-zinc-400">© 2025 Cino Consultancy<br><span class=text-xs>KVK: 89913019</span></p></div></div></div></div></div></div></footer></div></body></html>