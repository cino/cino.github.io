<!doctype html><html class="h-full antialiased" style=--header-position:sticky;--content-offset:0px;--header-height:64px;--header-mb:0px;--header-top:0px;--avatar-top:0px lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Private AppSync with custom dns - Cino</title><link rel=canonical href=https://cino.io/2025/private-appsync-with-custom-dns/><link rel=alternate type=application/rss+xml title=RSS href=https://cino.io/index.xml><link rel=icon type=image/png href=/favicon-96x96.png sizes=96x96><link rel=icon type=image/svg+xml href=/favicon.svg><link rel="shortcut icon" href=/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><meta name=apple-mobile-web-app-title content="Cino.io"><link rel=manifest href=/site.webmanifest><meta property="og:url" content="https://cino.io/2025/private-appsync-with-custom-dns/"><meta property="og:site_name" content="Cino"><meta property="og:title" content="Private AppSync with custom dns"><meta property="og:description" content="In the last year I’ve been working a lot with AppSync and I have to say it didn’t come without challenges. One of the biggest challenges was to create a private AppSync API with a custom domain. This is something that is not natively supported by AWS, but it is possible to achieve it using a combination of services.
While this is now possible for API Gateway, AppSync is a different beast. There is no native way to create a private AppSync API with a private custom domain. This is something that I had to figure out the hard way, and I want to share my findings with you.
This might become a bit of a long read, but if you are looking for a way to create a private AppSync API with a custom domain, you are in the right place. I will try to explain the steps I took to achieve this and the challenges I faced along the way."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="2025"><meta property="article:published_time" content="2025-06-06T18:00:00+01:00"><meta property="article:modified_time" content="2025-06-06T18:00:00+01:00"><meta property="article:tag" content="Aws"><meta property="article:tag" content="Amazon Web Services"><meta property="article:tag" content="Tags/AppSync"><meta property="article:tag" content="Networking"><meta property="article:tag" content="Vpc"><meta property="article:tag" content="Dns"><meta name=twitter:card content="summary"><meta name=twitter:title content="Private AppSync with custom dns"><meta name=twitter:description content="In the last year I’ve been working a lot with AppSync and I have to say it didn’t come without challenges. One of the biggest challenges was to create a private AppSync API with a custom domain. This is something that is not natively supported by AWS, but it is possible to achieve it using a combination of services.
While this is now possible for API Gateway, AppSync is a different beast. There is no native way to create a private AppSync API with a private custom domain. This is something that I had to figure out the hard way, and I want to share my findings with you.
This might become a bit of a long read, but if you are looking for a way to create a private AppSync API with a custom domain, you are in the right place. I will try to explain the steps I took to achieve this and the challenges I faced along the way."><meta itemprop=name content="Private AppSync with custom dns"><meta itemprop=description content="In the last year I’ve been working a lot with AppSync and I have to say it didn’t come without challenges. One of the biggest challenges was to create a private AppSync API with a custom domain. This is something that is not natively supported by AWS, but it is possible to achieve it using a combination of services.
While this is now possible for API Gateway, AppSync is a different beast. There is no native way to create a private AppSync API with a private custom domain. This is something that I had to figure out the hard way, and I want to share my findings with you.
This might become a bit of a long read, but if you are looking for a way to create a private AppSync API with a custom domain, you are in the right place. I will try to explain the steps I took to achieve this and the challenges I faced along the way."><meta itemprop=datePublished content="2025-06-06T18:00:00+01:00"><meta itemprop=dateModified content="2025-06-06T18:00:00+01:00"><meta itemprop=wordCount content="1330"><meta itemprop=keywords content="Aws,Amazon Web Services,Tags/AppSync,Networking,Vpc,Dns,Vpc Endpoint,Private,Route 53,Application Load Balancer,Tags/Containers,Tags/Nginx,Tags/Proxy"><link rel=stylesheet href="https://cino.io/css/styles.min.3190ac18f06f9ff7df7a441f800427c7220c439b69553e851c7218a39a14f9c2.css" integrity="sha256-MZCsGPBvn/ffekQfgAQnxyIMQ5tpVT6FHHIYo5oU+cI="><meta name=fediverse:creator content="@cino@fosstodon.org"><script async src="https://www.googletagmanager.com/gtag/js?id=G-GCGJ9S1XSX"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-GCGJ9S1XSX")}</script></head><body class="flex h-full flex-col bg-zinc-50"><div class="fixed inset-0 flex justify-center sm:px-8"><div class="flex w-full max-w-7xl lg:px-8"><div class="w-full bg-white ring-1 ring-zinc-100"></div></div></div><div class=relative><header class="pointer-events-none relative z-50 flex flex-col" style=height:var(--header-height);margin-bottom:var(--header-mb)><div class="top-0 z-10 h-16 pt-6" style=position:var(--header-position)><div class="sm:px-8 top-[var(--header-top,theme(spacing.6))] w-full" style=position:var(--header-inner-position)><div class="mx-auto max-w-7xl lg:px-8"><div class="relative px-4 sm:px-8 lg:px-12"><div class="mx-auto max-w-2xl lg:max-w-5xl"><div class="relative flex gap-4"><div class="flex flex-1"><div class="h-10 w-10 rounded-full bg-white/90 p-0.5 shadow-lg shadow-zinc-800/5 ring-1 ring-zinc-900/5 backdrop-blur"><a aria-label=Home class=pointer-events-auto href=https://cino.io/><img alt sizes=2.25rem src=/img/ricardo-cino-36x36.jpg decoding=async data-nimg=1 class="rounded-full bg-zinc-100 object-cover h-9 w-9" style=color:transparent width=512 height=512 alt="Ricardo Cino"></a></div></div><div class="flex flex-1 justify-end md:justify-center"><nav class="pointer-events-auto block"><ul class="flex rounded-full bg-white/90 px-3 text-sm font-medium text-zinc-800 shadow-lg shadow-zinc-800/5 ring-1 ring-zinc-900/5 backdrop-blur"><li><a class="relative block px-3 py-2 transition hover:text-teal-500" href=/>Home</a></li></ul></nav></div><div class="flex justify-end md:flex-1"></div></div></div></div></div></div></div></header><main><div class="sm:px-8 mt-16 lg:mt-32"><div class="mx-auto max-w-7xl lg:px-8"><div class="relative px-4 sm:px-8 lg:px-12"><div class="mx-auto max-w-2xl lg:max-w-5xl"><div class=xl:relative><div class="mx-auto max-w-2xl"><a href=/ aria-label="Go back to articles" class="group mb-8 flex h-10 w-10 items-center justify-center rounded-full bg-white shadow-md shadow-zinc-800/5 ring-1 ring-zinc-900/5 transition dark:border dark:border-zinc-700/50 dark:bg-zinc-800 dark:ring-0 dark:ring-white/10 dark:hover:border-zinc-700 dark:hover:ring-white/20 lg:absolute lg:-left-5 lg:mb-0 lg:-mt-2 xl:-top-1.5 xl:left-0 xl:mt-0"><svg viewBox="0 0 16 16" fill="none" aria-hidden="true" class="h-4 w-4 stroke-zinc-500 transition group-hover:stroke-zinc-700 dark:stroke-zinc-500 dark:group-hover:stroke-zinc-400"><path d="M7.25 11.25 3.75 8m0 0 3.5-3.25M3.75 8h8.5" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></a><article><header class="flex flex-col"><time datetime=2025-06-06 class="order-first flex items-center text-base text-zinc-400 dark:text-zinc-500"><span class="h-4 w-0.5 rounded-full bg-zinc-200 dark:bg-zinc-500"></span>
<span class=ml-3>June 6, 2025</span>
<span class="h-4 ml-4 w-0.5 rounded-full bg-zinc-200 dark:bg-zinc-500"></span>
<span class=ml-3>7 min read</span></time><div class="relative mt-4 text-zinc-400"><a href=/tags/aws/ class=hover:text-zinc-200>#aws</a>, <a href=/tags/amazon-web-services/ class=hover:text-zinc-200>#amazon web services</a>, <a href=/tags/appsync/ class=hover:text-zinc-200>#AppSync</a>, <a href=/tags/networking/ class=hover:text-zinc-200>#networking</a>, <a href=/tags/vpc/ class=hover:text-zinc-200>#vpc</a>, <a href=/tags/dns/ class=hover:text-zinc-200>#dns</a>, <a href=/tags/vpc-endpoint/ class=hover:text-zinc-200>#vpc endpoint</a>, <a href=/tags/private/ class=hover:text-zinc-200>#private</a>, <a href=/tags/route-53/ class=hover:text-zinc-200>#route 53</a>, <a href=/tags/application-load-balancer/ class=hover:text-zinc-200>#application load balancer</a>, <a href=/tags/containers/ class=hover:text-zinc-200>#containers</a>, <a href=/tags/nginx/ class=hover:text-zinc-200>#nginx</a>, <a href=/tags/proxy/ class=hover:text-zinc-200>#proxy</a></div><h1 class="mt-6 text-4xl font-bold tracking-tight text-zinc-800 dark:text-zinc-100 sm:text-5xl">Private AppSync with custom dns</h1></header><div class="mt-8 prose dark:prose-invert"><p>In the last year I&rsquo;ve been working a <strong>lot</strong> with AppSync and I have to say it didn&rsquo;t come without challenges. One of the biggest challenges was to create a private AppSync API with a custom domain. This is something that is not natively supported by AWS, but it is possible to achieve it using a combination of services.</p><p>While this is now possible for API Gateway, AppSync is a different beast. There is no native way to create a private AppSync API with a private custom domain. This is something that I had to figure out the hard way, and I want to share my findings with you.</p><p>This might become a bit of a long read, but if you are looking for a way to create a private AppSync API with a custom domain, you are in the right place. I will try to explain the steps I took to achieve this and the challenges I faced along the way.</p><h1 id=what-is-appsync>What is AppSync?</h1><p>AppSync is a fully managed service that makes it easy for developers to build scalable Graphql APIs on AWS. It allows you to create a flexible API for applications that require real-time data, such as mobile or web apps. With GraphQL support, AppSync helps you to define the structure of your data and how it can be queried.</p><p>With AppSync, you can easily connect to various data sources, including DynamoDB, Lambda, Elasticsearch, and more. It also provides built-in support for real-time subscriptions, offline data synchronization, and security features like authentication and authorization.</p><p>While there are other challenges with Authorization, which I will not cover in this article (but <em>surely</em> in a follow-up), I will focus on how to create a private AppSync API with a custom domain and all the challenges that come with it.</p><h1 id=target-architecture>Target Architecture</h1><p><picture><source media="(min-width: 600px)" srcset=/2025/private-appsync-with-custom-dns/target-architecture_hu_cd5506cb4edd0c53.webp type=image/webp><source media="(min-width: 300px)" srcset=/2025/private-appsync-with-custom-dns/target-architecture_hu_12efc79fc1c97349.webp type=image/webp><source media="(max-width: 300px)" srcset=/2025/private-appsync-with-custom-dns/target-architecture_hu_48e42328178d33b5.webp type=image/webp><img loading=lazy src=/2025/private-appsync-with-custom-dns/target-architecture_hu_a848492efdb307a3.png alt="Target Architecture" width=100% height=311>
</picture><em>(spoiler: We will <strong>not</strong> reach this architecture)</em></p><p>This would be the ideal situation i&rsquo;d like to see, however this is not possible with the current state of AppSync, with the main reason being that it&rsquo;s currently not possible to add a custom domain to a private AppSync API. Which results in that when you do try to point</p><h1 id=private-appsync-api>Private AppSync API</h1><h2 id=making-it-private>Making it private</h2><p>Making AWS AppSync private itself is not a big deal, you just need to toggle the <code>Use private API features</code> option in the AppSync console. This will allow you to create a private AppSync API that is only accessible from within your VPC. This is done by creating a VPC endpoint for AppSync, which allows you to access the service without going through the public internet.</p><blockquote><p><strong>Disclaimer 1</strong>: You can not make a public AppSync API private, this needs to be configured at the start. This is a limitation of AppSync itself and not something that can be changed later on.</p></blockquote><blockquote><p><strong>Disclaimer 2</strong>: When you make an AppSync API private, you will not be able to access it from the aws console and losing the ability to use the console to test your API. This can be overcome by using the <a href=/2024/aws-cloudshell-in-your-own-vpc/ target=_blank alt="AWS CloudShell in your own vpc">CloudShell</a> from your vpc or by deploying an EC2 instance inside your vpc.</p></blockquote><h2 id=private-appsync-api-with-custom-domain>Private AppSync API with custom domain</h2><p>Now this is the part where it becomes challenging, because AppSync does not support private APIs with custom domains. This means that you will not be able to use the default AppSync endpoint, which is something that you will have to work around by using additional services.</p><h2 id=why-a-custom-domain-again>Why a custom domain again?</h2><p>While you could use the default AppSync endpoint, this is not recommended for production use. In case of a service replacement, you will have to update all your clients with the new endpoint. This is not a big deal if you are using a single client, but if you are using multiple clients (e.g. mobile and web), this can become a nightmare.</p><p>Even if you&rsquo;d decide to switch to hosting your own GraphQL server you might be able to switch the back-end and not inform the client, if you keep supporting the exact same features as you are using. If you are using Subscriptions from AppSync it might become more challenging due to the implementation of AWS AppSync&rsquo;s authorization mechanism.</p><h2 id=creating-custom-dns-for-your-appsync-api>Creating custom DNS for your AppSync API</h2><p>To make your AppSync API accessible from a custom domain, you will have to use the same approach as you would for API Gateway. This means that you will have to create a Route 53 hosted zone for your custom domain and create a CNAME record that points to an Application Load Balancer that routes traffic to the AppSync VPC Endpoint.</p><p>However this is not enough, because where this will allow you to access the AppSync API from your custom domain, it will not allow you to <em>only</em> use the custom domain. Additionally you will have to send an HTTP header (X-AppSync-Domain) to the AppSync API that contains the custom domain name so the VPC Endpoint can route the traffic to the correct AppSync API. In that case you still need to share the AppSync API endpoint with the end user.</p><p>The only way to avoid this limitation is to use a proxy that will route the traffic to the AppSync API. This can be done by using an Application Load Balancer with a custom domain and a target group that points a proxy (e.g. NGINX) that will route the traffic to the AppSync API. This way you can use the custom domain to access the AppSync API without exposing the AppSync API endpoint to the end user.</p><blockquote><p><strong>Disclaimer 3</strong>: Whenever you use a custom private domain the default libraries provided (AppSync SDK & Amplify Framework&rsquo;s AppSync, see <a href=https://github.com/aws-amplify/amplify-data/issues/469 target=_blank>this issue</a> (especially the comment of <code>sleepwithcoffee</code> too.)) by AWS will not work. This is because the libraries are using the default AppSync endpoint and not the custom domain. This means that you will have to use a custom implementation of the AppSync client that supports custom domains.</p></blockquote><p>To implement such proxy you can use NGINX, which is a popular web server that can be used as a reverse proxy. NGINX can be configured to route traffic to the AppSync API and add the required HTTP header (X-AppSync-Domain) to the request.</p><h3 id=example>Example</h3><pre tabindex=0><code>  location /graphql {
    proxy_set_header X-AppSync-Domain ${identifier}.appsync-api.eu-west-1.amazonaws.com;
    proxy_pass https://${url};
    proxy_pass_request_headers on;
    proxy_ssl_session_reuse off;
    proxy_cache_bypass $http_upgrade;
    proxy_redirect off;
    ...
  }

  location /graphql/ws {
    proxy_set_header X-AppSync-Domain ${identifier}.appsync-realtime-api.eu-west-1.amazonaws.com;
    proxy_pass https://${url};
    proxy_pass_request_headers on;
    proxy_ssl_session_reuse off;
    proxy_cache_bypass $http_upgrade;
    proxy_redirect off;
    ...
  }
</code></pre><h2 id=final-architecture>Final architecture</h2><p>If we want to invoke our AppSync API from our custom DNS only the architecture will look like this:</p><picture><source media="(min-width: 600px)" srcset=/2025/private-appsync-with-custom-dns/final-architecture_hu_5d4e522936d828ce.webp type=image/webp><source media="(min-width: 300px)" srcset=/2025/private-appsync-with-custom-dns/final-architecture_hu_5870934325d59947.webp type=image/webp><source media="(max-width: 300px)" srcset=/2025/private-appsync-with-custom-dns/final-architecture_hu_b925f85628ce128e.webp type=image/webp><img loading=lazy src=/2025/private-appsync-with-custom-dns/final-architecture_hu_f1d77dda80adf15.png alt="Final Architecture" width=100% height=303></picture><p>Why is that? Well, the only way to access an AppSync API privately from your VPC is to use a VPC endpoint. This means that you will have to create a VPC endpoint for AppSync and route traffic from your custom domain to the VPC endpoint. This is done by creating an Application Load Balancer with the desired Custom DNS. Behind the ALB you will have 2 target groups, one for the AppSync VPC endpoint Private IP address to directly access the AppSync API and another one for the proxy that will be used to access the AppSync API from the browser.</p><p>With this setup, you can access the AppSync API from your custom domain without exposing the AppSync API endpoint to the end user. The proxy will handle the routing of the traffic to the AppSync API and will add the required HTTP header (X-AppSync-Domain) to the request.</p><h1 id=wishes>Wishes</h1><p>Like API Gateway, AppSync is a service that is constantly evolving. I hope that in the future we will have a native way to create private AppSync APIs with custom domains. This would make our lives a lot easier and would eliminate the need for workarounds like the one I described in this article.</p><h1 id=sources>Sources</h1><ul><li>AWS Enterprise Support</li><li><a href=https://docs.aws.amazon.com/AppSync/latest/devguide/using-private-apis.html target=_blank><a href=https://docs.aws.amazon.com/AppSync/latest/devguide/using-private-apis.html>https://docs.aws.amazon.com/AppSync/latest/devguide/using-private-apis.html</a></a></li><li><a href=https://docs.aws.amazon.com/AppSync/latest/devguide/real-time-websocket-client.html target=_blank><a href=https://docs.aws.amazon.com/AppSync/latest/devguide/real-time-websocket-client.html>https://docs.aws.amazon.com/AppSync/latest/devguide/real-time-websocket-client.html</a></a></li><li><a href=https://github.com/aws-amplify/amplify-data/issues/469#issuecomment-2578784043 target=_blank><a href=https://github.com/aws-amplify/amplify-data/issues/469#issuecomment-2578784043>https://github.com/aws-amplify/amplify-data/issues/469#issuecomment-2578784043</a></a></li></ul><p>I hope this post was helpful to you and if you have any questions or remarks feel free to reach out to me on <a href=https://bsky.app/profile/cino.io target=_blank>Bluesky</a> or <a href=https://www.linkedin.com/in/cinoricardo/ target=_blank>LinkedIn</a>.</p></div></article></div></div></div></div></div></div></main><footer class=mt-32><div class=sm:px-8><div class="mx-auto max-w-7xl lg:px-8"><div class="border-t border-zinc-100 pt-10 pb-16 0"><div class="relative px-4 sm:px-8 lg:px-12"><div class="mx-auto max-w-2xl lg:max-w-5xl"><div class="flex flex-col items-center justify-between gap-6 sm:flex-row"><div class="flex gap-6 text-sm font-medium text-zinc-800"><a class="transition hover:text-teal-500" href=/>Home</a></div><p class="text-sm text-zinc-400">© 2025 Cino Consultancy<br><span class=text-xs>KVK: 89913019</span></p></div></div></div></div></div></div></footer></div></body></html>