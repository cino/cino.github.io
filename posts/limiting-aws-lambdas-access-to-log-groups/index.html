<!doctype html><html lang=en-us data-theme><head><meta charset=utf-8><meta name=HandheldFriendly content="True"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer-when-downgrade"><title>Limiting AWS Lambda's access to Log Groups - Cino</title><meta name=description content="About a year ago I asked the question on Reddit what people thought of the default Lambda role called &ldquo;AWSLambdaBasicExecutionRole&rdquo; and why I thought it was way too open to be a default.
To this day I  still think this role shouldn&rsquo;t be used at all, but rather be deleted by Amazon itself. While I agree that Amazon wants people to get started as quickly as possible it is not in line with the least access principle. For this reason, I always define the role myself, for starters only allowing the Lambda function to write to its own CloudWatch Log Group. There is no reason for the Lambda function to be able to write to log groups of other services rather than its own."><link rel=icon type=image/x-icon href=https://cino.github.io/favicon.ico><link rel=apple-touch-icon-precomposed href=https://cino.github.io/favicon.png><style>body{visibility:hidden;opacity:0}</style><noscript><style>body{visibility:visible;opacity:1}</style></noscript><link rel=stylesheet href=https://cino.github.io/css/style.min.aac3b3a2a3235d20a652d9ccde7ec59be09f74c45de387513f681d02f3912b95.css integrity="sha256-qsOzoqMjXSCmUtnM3n7Fm+CfdMRd44dRP2gdAvORK5U="><script src=https://cino.github.io/js/script.min.74bf1a3fcf1af396efa4acf3e660e876b61a2153ab9cbe1893ac24ea6d4f94ee.js type=text/javascript integrity="sha256-dL8aP88a85bvpKzz5mDodrYaIVOrnL4Yk6wk6m1PlO4="></script><meta property="og:title" content="Limiting AWS Lambda's access to Log Groups"><meta property="og:description" content="About a year ago I asked the question on Reddit what people thought of the default Lambda role called &ldquo;AWSLambdaBasicExecutionRole&rdquo; and why I thought it was way too open to be a default.
To this day I  still think this role shouldn&rsquo;t be used at all, but rather be deleted by Amazon itself. While I agree that Amazon wants people to get started as quickly as possible it is not in line with the least access principle. For this reason, I always define the role myself, for starters only allowing the Lambda function to write to its own CloudWatch Log Group. There is no reason for the Lambda function to be able to write to log groups of other services rather than its own."><meta property="og:type" content="article"><meta property="og:url" content="https://cino.github.io/posts/limiting-aws-lambdas-access-to-log-groups/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-05-11T00:00:00+00:00"><meta property="article:modified_time" content="2022-05-11T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Limiting AWS Lambda's access to Log Groups"><meta name=twitter:description content="About a year ago I asked the question on Reddit what people thought of the default Lambda role called &ldquo;AWSLambdaBasicExecutionRole&rdquo; and why I thought it was way too open to be a default.
To this day I  still think this role shouldn&rsquo;t be used at all, but rather be deleted by Amazon itself. While I agree that Amazon wants people to get started as quickly as possible it is not in line with the least access principle. For this reason, I always define the role myself, for starters only allowing the Lambda function to write to its own CloudWatch Log Group. There is no reason for the Lambda function to be able to write to log groups of other services rather than its own."></head><body><a class=skip-main href=#main>Skip to main content</a><div class=container><header class=common-header><div class=header-top><h1 class=site-title><a href=/>Cino</a></h1><ul class=social-icons><li><a href=https://github.com/cino title=Github rel=me><span class=inline-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></a></li><li><a href=https://twitter.com/ricardocino title=Twitter rel=me><span class=inline-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645.0 138.72-105.583 298.558-298.558 298.558-59.452.0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055.0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421.0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391.0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04.0-57.828 46.782-104.934 104.934-104.934 30.213.0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg></span></a></li><li><a href=https://cino.github.io/index.xml title=RSS rel=me><span class=inline-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M128.081 415.959c0 35.369-28.672 64.041-64.041 64.041S0 451.328.0 415.959s28.672-64.041 64.041-64.041 64.04 28.673 64.04 64.041zm175.66 47.25c-8.354-154.6-132.185-278.587-286.95-286.95C7.656 175.765.0 183.105.0 192.253v48.069c0 8.415 6.49 15.472 14.887 16.018 111.832 7.284 201.473 96.702 208.772 208.772.547 8.397 7.604 14.887 16.018 14.887h48.069c9.149.001 16.489-7.655 15.995-16.79zm144.249.288C439.596 229.677 251.465 40.445 16.503 32.01 7.473 31.686.0 38.981.0 48.016v48.068c0 8.625 6.835 15.645 15.453 15.999 191.179 7.839 344.627 161.316 352.465 352.465.353 8.618 7.373 15.453 15.999 15.453h48.068c9.034-.001 16.329-7.474 16.005-16.504z"/></svg></span></a></li></ul></div><nav><a href=https://cino.github.io/ title=Home>Home</a>
<a href=https://cino.github.io/about/ title="About me">About me</a></nav></header><main id=main tabindex=-1><article class="post h-entry"><div class=post-header><header><h1 class="p-name post-title">Limiting AWS Lambda's access to Log Groups</h1></header></div><div class="content e-content"><p>About a year ago I asked the question on <a href=https://www.reddit.com/r/aws/comments/o3fbge/is_awslambdabasicexecutionrole_not_way_too_open/>Reddit</a> what people thought of the default Lambda role called &ldquo;AWSLambdaBasicExecutionRole&rdquo; and why I thought it was way too open to be a default.</p><p>To this day I still think this role shouldn&rsquo;t be used at all, but rather be deleted by Amazon itself. While I agree that Amazon wants people to get started as quickly as possible it is not in line with the least access principle. For this reason, I always define the role myself, for starters only allowing the Lambda function to write to its own CloudWatch Log Group. There is no reason for the Lambda function to be able to write to log groups of other services rather than its own.</p><p>Luckily it&rsquo;s quite simple to create a custom permission for the Lambda function using the CDK. We can simply create a custom role, assign the role without permissions to the Lambda function, then add the custom permission to the role allowing the correct permissions to write to the CloudWatchlog group. Why in this order? We need this order to retrieve the generated LogGroup location from the Lambda in the permission, if we wouldn&rsquo;t be using the AWS CDK we would&rsquo;ve done this directly in the permission by assuming the correct name. Luckily this isn&rsquo;t necessary and this is future proof (and re-usable when you put it in a custom struct/generate it in a function).</p><p>As an example, I&rsquo;ve created the smallest working CDK project which displays exactly how this can be realized below:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// Create your custom IAM Role
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>customRole</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Role</span>(<span style=color:#66d9ef>this</span>, <span style=color:#e6db74>&#39;CustomRole&#39;</span>, {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>roleName</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;CustomRole&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>assumedBy</span>: <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>ServicePrincipal</span>(<span style=color:#e6db74>&#39;lambda.amazonaws.com&#39;</span>),
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// create smallest lambda function possible and assign the custom role.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>lambdaFunction</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>NodejsFunction</span>(<span style=color:#66d9ef>this</span>, <span style=color:#e6db74>&#39;Function&#39;</span>, {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>entry</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;./dist/function.js&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>role</span>: <span style=color:#66d9ef>customRole</span>,
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Create an inline policy which only allows the role to write logs to the log group
</span></span></span><span style=display:flex><span><span style=color:#75715e>// that is automatically created by the lambda function.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>customRole</span>.<span style=color:#a6e22e>attachInlinePolicy</span>(
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Policy</span>(<span style=color:#66d9ef>this</span>, <span style=color:#e6db74>&#39;loggingPolicy&#39;</span>, {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>statements</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>PolicyStatement</span>({
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>effect</span>: <span style=color:#66d9ef>Effect.ALLOW</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>actions</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#39;logs:CreateLogGroup&#39;</span>,
</span></span><span style=display:flex><span>        ],
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>resources</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#39;*&#39;</span>],
</span></span><span style=display:flex><span>      }),
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>PolicyStatement</span>({
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>effect</span>: <span style=color:#66d9ef>Effect.ALLOW</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>actions</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#39;logs:CreateLogStream&#39;</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#39;logs:PutLogEvents&#39;</span>,
</span></span><span style=display:flex><span>        ],
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>resources</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>lambdaFunction</span>.<span style=color:#a6e22e>logGroup</span>.<span style=color:#a6e22e>logGroupArn</span>,
</span></span><span style=display:flex><span>        ],
</span></span><span style=display:flex><span>      }),
</span></span><span style=display:flex><span>    ],
</span></span><span style=display:flex><span>  }),
</span></span><span style=display:flex><span>);</span></span></code></pre></div><p>A full working example can be found in my Github repository containing this and future examples at <a href=https://github.com/cino/cdk-examples/tree/main/lambda-custom-role>this location</a>.</p></div><div class=post-info><div class="post-date dt-published">2022-05-11</div><a class="post-hidden-url u-url" href=https://cino.github.io/posts/limiting-aws-lambdas-access-to-log-groups/>https://cino.github.io/posts/limiting-aws-lambdas-access-to-log-groups/</a>
<a href=https://cino.github.io class="p-name p-author post-hidden-author h-card" rel=me>Ricardo Cino</a><div class=post-taxonomies><ul class=post-tags><li><a href=https://cino.github.io/tags/aws/>#aws</a></li><li><a href=https://cino.github.io/tags/serverless/>#serverless</a></li></ul></div></div></article><h3 class=read-next-title>Read next</h3><ul class=read-next-posts><li><a href=/posts/building-a-serverless-kanban-board/>Building a Serverless Kanban Board</a></li><li><a href=/posts/static-website-distribution-with-aws-cloudfront/>Static website distribution with AWS CloudFront</a></li></ul><div class="pagination post-pagination"><div class="left pagination-item disabled"></div><div class="right pagination-item"><a href=/posts/building-a-serverless-kanban-board/>Building a Serverless Kanban Board</a></div></div></main><footer class=common-footer><div class=common-footer-bottom><div class=copyright><p>© Ricardo Cino, 2023<br>Powered by <a target=_blank rel="noopener noreferrer" href=https://gohugo.io/>Hugo</a>, theme <a target=_blank rel="noopener noreferrer" href=https://github.com/mitrichius/hugo-theme-anubis>Anubis</a>.<br></p></div><button class=theme-switcher>
Dark theme</button>
<script>const STORAGE_KEY="user-color-scheme",defaultTheme="light-with-switcher";let currentTheme,switchButton,autoDefinedScheme=window.matchMedia("(prefers-color-scheme: dark)");const autoChangeScheme=e=>{currentTheme=e.matches?"dark":"light",document.documentElement.setAttribute("data-theme",currentTheme),changeButtonText()};document.addEventListener("DOMContentLoaded",function(){switchButton=document.querySelector(".theme-switcher"),currentTheme=detectCurrentScheme(),currentTheme=="dark"&&document.documentElement.setAttribute("data-theme","dark"),currentTheme=="auto"&&(autoChangeScheme(autoDefinedScheme),autoDefinedScheme.addListener(autoChangeScheme)),switchButton&&(changeButtonText(),switchButton.addEventListener("click",switchTheme,!1)),showContent()});function detectCurrentScheme(){return localStorage.getItem(STORAGE_KEY)?localStorage.getItem(STORAGE_KEY):defaultTheme?defaultTheme:window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":"light"}function changeButtonText(){switchButton&&(switchButton.textContent=currentTheme=="dark"?"Light theme":"Dark theme")}function switchTheme(){currentTheme=="dark"?(localStorage.setItem(STORAGE_KEY,"light"),document.documentElement.setAttribute("data-theme","light"),currentTheme="light"):(localStorage.setItem(STORAGE_KEY,"dark"),document.documentElement.setAttribute("data-theme","dark"),currentTheme="dark"),changeButtonText()}function showContent(){document.body.style.visibility="visible",document.body.style.opacity=1}</script></div><p class="h-card vcard"><a href=https://cino.github.io class="p-name u-url url fn" rel=me>Ricardo Cino</a>
/
<a class="p-email u-email email" rel=me href=mailto:ricardo@cino.io>ricardo@cino.io</a>
<img class=u-photo src=/images/me.png></p></footer></div></body></html>